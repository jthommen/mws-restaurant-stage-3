class ApiService{static fetchApiData(e,t){if(!navigator.onLine&&("favorize"===e.name||"addReview"===e.name))return void LocalState.sendDataWhenOnline(e);let a,o;switch(e.name){case"restaurants":a="http://localhost:1337/restaurants",o={method:"GET"};break;case"restaurantById":a=`http://localhost:1337/restaurants/${e.object_id}`,o={method:"GET"};case"reviews":a="http://localhost:1337/reviews",o={method:"GET"};break;case"reviewById":a=`http://localhost:1337/reviews/?restaurant_id=${e.object_id}`,o={method:"GET"};break;case"addReview":a="http://localhost:1337/reviews";let t={name:e.data[0],rating:parseInt(e.data[1]),comments:e.data[2],restaurant_id:parseInt(e.data[3])};o={method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})};break;case"favorize":a=`http://localhost:1337/restaurants/${e.object_id}/?is_favorite=${e.data}`,o={method:"PUT"}}fetch(a,o).then(t=>{console.log(`Server: ${e.name} api called`);const a=t.headers.get("content-type");return a&&-1!==a.indexOf("application/json")?t.json():"API call successfull"}).then(e=>{t(null,e)}).catch(e=>t(e,null))}}class LocalState{static setupIDBStores(e){switch(e){case"restaurants":return idb.open("restaurants",1,e=>{e.createObjectStore("restaurants",{keyPath:"id"})});case"reviews":return idb.open("reviews",1,e=>{e.createObjectStore("reviews",{keyPath:"id"}).createIndex("by-restaurantId","restaurant_id")})}}static checkforIDBData(e,t){LocalState.setupIDBStores(e.object_type).then(t=>{return t.transaction(e.object_type).objectStore(e.object_type).getAll()}).then(a=>{if(a.length>0){console.log(`IDB: ${e.name} retrieved:`,a),t(null,a);let o=localStorage.getItem("dataRefreshed");(!o||(o-new Date)/1e3>300)&&(localStorage.setItem("dataRefreshed",new Date),ApiService.fetchApiData(e,(t,a)=>{let o=new Worker("js/worker.js"),r={api:e.name,objects:a};o.postMessage(r),o.onmessage=(e=>console.log(e.data))}))}else console.log(`IDB: No ${e.name} found`),ApiService.fetchApiData(e,(a,o)=>{LocalState.setupIDBStores(e.object_type).then(t=>{let a=t.transaction(e.object_type,"readwrite").objectStore(e.object_type);return o.forEach(e=>{a.put(e)}),console.log("IDB: Data stored: ",o),o}).then(e=>t(null,e))})})}static updateIDBData(e,t){let a=LocalState.setupIDBStores(e.object_type);a.then(t=>{return t.transaction(e.object_type).objectStore(e.object_type).get(e.object_id)}).then(o=>{o.is_favorite=e.data,a.then(t=>{t.transaction(e.object_type,"readwrite").objectStore(e.object_type).put(o)}).then(()=>t(null,`IDB: ${o.name} favorized!`))})}static sendDataWhenOnline(e){console.log(e),localStorage.setItem("data",JSON.stringify(e.data)),console.log(`Local Storage: ${e.object_type} stored`),window.addEventListener("online",t=>{let a=JSON.parse(localStorage.getItem("data"));null!==a&&(console.log(a),ApiService.fetchApiData(e,(e,t)=>{e?console.log(e):console.log(t)}),console.log("LocalState: data sent to api"),localStorage.removeItem("data"),console.log(`Local Storage: ${e.object_type} removed`)),console.log("Browser: Online again!")})}static getRestaurantById(e,t){let a={name:"restaurantById",object_type:"restaurants",object_id:e};LocalState.checkforIDBData(a,(a,o)=>{if(a)t(a,null);else{const a=o.find(t=>t.id==e);a?t(null,a):t("Restaurant does not exist",null)}})}static getRestaurantByCuisine(e,t){LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(a,o)=>{if(a)t(a,null);else{const a=o.filter(t=>t.cuisine_type==e);t(null,a)}})}static getRestaurantByNeighborhood(e,t){LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(a,o)=>{if(a)t(a,null);else{const a=o.filter(t=>t.neighborhood==e);t(null,a)}})}static getRestaurantByCuisineAndNeighborhood(e,t,a){LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(o,r)=>{if(o)a(o,null);else{let o=r;"all"!==e&&(o=o.filter(t=>t.cuisine_type===e)),"all"!=t&&(o=o.filter(e=>e.neighborhood===t)),a(null,o)}})}static getNeighborhoods(e){LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].neighborhood),o=t.filter((e,a)=>t.indexOf(e)==a);e(null,o)}})}static getCuisines(e){LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].cuisine_type),o=t.filter((e,a)=>t.indexOf(e)==a);e(null,o)}})}static getReviewsByRestaurant(e,t){let a={name:"reviewById",object_type:"reviews",object_id:e};LocalState.checkforIDBData(a,(a,o)=>{if(a)t(null,a);else{const a=o.filter(t=>t.restaurant_id===e);t(null,a)}})}static getUrlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static getImageUrlForRestaurant(e){return`/img/${e.photograph}.jpg`}static getMapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:LocalState.getUrlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}static toggleFavorite(e,t){let a={name:"favorize",object_type:"restaurants",object_id:t=parseInt(t),data:e};LocalState.updateIDBData(a,(e,t)=>{e&&console.log(e)}),ApiService.fetchApiData(a,(e,t)=>{e?console.log(e):console.log(`Server: ${t.name} updated`)})}static addReview(e){let t={name:"addReview",data:e,object_type:"review"};ApiService.fetchApiData(t,(e,t)=>{e?console.log(e):console.log("Server: Review uploaded")})}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkFwaVNlcnZpY2UiLCJbb2JqZWN0IE9iamVjdF0iLCJhcGkiLCJjYWxsYmFjayIsIm5hdmlnYXRvciIsIkxvY2FsU3RhdGUiLCJzZW5kRGF0YVdoZW5PbmxpbmUiLCJhcGlfdXJsIiwiZmV0Y2hfb3B0aW9ucyIsIm1ldGhvZCIsIm9iamVjdF9pZCIsInJldmlldyIsIm5hbWUiLCJkYXRhIiwicmF0aW5nIiwicGFyc2VJbnQiLCJjb21tZW50cyIsInJlc3RhdXJhbnRfaWQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwiY29udGVudFR5cGUiLCJnZXQiLCJqc29uIiwiY2F0Y2giLCJlcnJvciIsInN0b3JlIiwicmVzdGF1cmFudERiUHJvbWlzZSIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsInJldmlld0RiUHJvbWlzZSIsImRiIiwic2V0dXBJREJTdG9yZXMiLCJvYmplY3RfdHlwZSIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwibGVuZ3RoIiwiZGF0YVJlZnJlc2hlZCIsImxvY2FsU3RvcmFnZSIsIkRhdGUiLCJmZXRjaEFwaURhdGEiLCJ3b3JrZXJEYXRhIiwiV29ya2VyIiwib2JqZWN0cyIsIndvcmtlciIsInBvc3RNZXNzYWdlIiwib25tZXNzYWdlIiwiZSIsInRyYW5zYWN0aW9uIiwib2JqZWN0IiwiZm9yRWFjaCIsInB1dCIsImRiUHJvbWlzZSIsImlzX2Zhdm9yaXRlIiwidHgiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicGFyc2UiLCJldmVudCIsImdldEl0ZW0iLCJyZW1vdmVJdGVtIiwiZ2V0UmVzdGF1cmFudEJ5SWQiLCJpZCIsImNoZWNrZm9ySURCRGF0YSIsInJlc3RhdXJhbnRzIiwiZ2V0UmVzdGF1cmFudEJ5Q3Vpc2luZSIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImdldFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZCIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsImN1aXNpbmUiLCJjdWlzaW5lcyIsIm5laWdoYm9yaG9vZCIsImZpbHRlcmVkUmVzdGF1cmFudHMiLCJnZXROZWlnaGJvcmhvb2RzIiwidW5pcXVlTmVpZ2hib3Job29kcyIsIm1hcCIsImkiLCJ2IiwibmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJyZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiZmlsdGVyZWRSZXZpZXdzIiwidW5pcXVlQ3Vpc2luZXMiLCJnZXRJbWFnZVVybEZvclJlc3RhdXJhbnQiLCJtYXBzIiwidGl0bGUiLCJ1cmwiLCJhbmltYXRpb24iLCJnb29nbGUiLCJtb2RlIiwicGhvdG9ncmFwaCIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwiYWRkUmV2aWV3IiwiQW5pbWF0aW9uIiwiRFJPUCIsInVwZGF0ZUlEQkRhdGEiXSwibWFwcGluZ3MiOiJNQUNNQSxXQUVMQyxvQkFBb0JDLEVBQUtDLEdBR3hCLElBQUdDLFVBQUNBLFNBQXFCLGFBQXRCRixFQUFzQkEsTUFBMkIsY0FBM0JBLEVBQTJCQSxNQUVuRCxZQURBRyxXQUFXQyxtQkFBbUJKLEdBSy9CLElBQUlLLEVBQ0FDLEVBRUosT0FBQU4sRUFBT0EsTUFDTixJQUFLLGNBQ0pLLEVBQVcsb0NBQ1hDLEdBQWdCQyxPQUFDQSxPQUNqQixNQUNELElBQUssaUJBQ0pGLHVDQUFrREwsRUFBSVEsWUFDdERGLEdBQWdCQyxPQUFDQSxPQUNsQixJQUFLLFVBQ0pGLEVBQVcsZ0NBQ1hDLEdBQWdCQyxPQUFDQSxPQUNqQixNQUNELElBQUssYUFDSkYsa0RBQTZETCxFQUFJUSxZQUNqRUYsR0FBZ0JDLE9BQUNBLE9BQ2pCLE1BQ0QsSUFBSyxZQUNKRixFQUFXLGdDQUVYLElBQUlJLEdBQ0hDLEtBQVFWLEVBQUlXLEtBQUssR0FDakJDLE9B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QUdabkcsV0FBQXNFLGdCQUFBekUsRUFBQSxDQUFBK0IsRUFBQStELEtBMUJDLEdBQUcvRCxFQUFPOUIsRUFBUyxLQUFNOEIsT0FFcEIsQ0E0Qk44RCxNQUFBQSxFQUF3QkEsRUFBQUEsT0FBeEJmLEdBQUFBLEVBQUEvRCxnQkFBQThFLEdBMUJFNUYsRUFBUyxLQUFNOEYsTUFnQ2hCcEYsMkJBQU00RixHQUpHLDhCQUFWM0IsRUFBQUosS0FRQ3pFLGdDQUFVNkUsR0FDVixjQUZEQSxFQUFBNEIsaUJBS0N6RSxpQ0FBNEJOLEVBQWErRCxHQVN6QzdFLE9BVkQsSUFBQTJGLE9BQUFKLEtBQUFPLFFBSUFDLFNBQUE5QixFQUFBK0IsT0EzQkNSLE1BQU92QixFQUFXbEUsS0E2QnBCMEYsSUFBT1EsV0FBVW5HLG9CQUFRbUUsR0EzQnZCWSxJQUFLQSxFQTZCTmEsVUFBVUMsT0FBQUosS0FBQVcsVUFBQUMsT0F2QlgvRyxzQkFBc0J3RyxFQUFNVixHQWdDMUIsSUFGRDdGLEdBSUFVLEtBQUEsV0E1QkNpQyxZQUFhLGNBcFRDbkMsVUE0VWZWLEVBQVdvRCxTQUFhbEQsR0F0QnZCVyxLQUFNNEYsR0FHUHBHLFdBQVc0RyxjQUFjL0csRUFBSyxDQUFDK0IsRUFBT3BCLEtBQ2xDb0IsR0FBT04sUUFBUUMsSUFBSUssS0FHdkJqQyxXQUFXb0QsYUFBYWxELEVBQUssQ0FBQytCLEVBQU9wQixLQUNwQ29CLEVBQVFOLFFBQVFDLElBQUlLLEdBQVFOLFFBQVFDLGVBQWVmLEVBQUtELGtCQUsxRFgsaUJBQWlCVSxHQUVoQixJQUFJVCxHQUNIVSxLQUFNLFlBQ05DLEtBQU1GLEVBQ05rQyxZQUFhLFVBSWQ3QyxXQUFXb0QsYUFBYWxELEVBQUssQ0FBQytCLEVBQU9wQixLQUNwQ29CLEVBQVFOLFFBQVFDLElBQUlLLEdBQVNOLFFBQVFDLElBQUsiLCJmaWxlIjoiZGJoZWxwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBUEkgSGFuZGxpbmdcclxuY2xhc3MgQXBpU2VydmljZSB7XHJcblxyXG5cdHN0YXRpYyBmZXRjaEFwaURhdGEoYXBpLCBjYWxsYmFjayl7XHJcblxyXG5cdFx0Ly8gQ2hlY2sgaWYgb25saW5lXHJcblx0XHRpZighbmF2aWdhdG9yLm9uTGluZSAmJiAoYXBpLm5hbWUgPT09ICdmYXZvcml6ZScgfHwgYXBpLm5hbWUgPT09ICdhZGRSZXZpZXcnKSkge1xyXG5cdFx0XHRMb2NhbFN0YXRlLnNlbmREYXRhV2hlbk9ubGluZShhcGkpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7XHJcblx0XHRsZXQgYXBpX3VybDtcclxuXHRcdGxldCBmZXRjaF9vcHRpb25zO1xyXG5cclxuXHRcdHN3aXRjaChhcGkubmFtZSkge1xyXG5cdFx0XHRjYXNlICdyZXN0YXVyYW50cyc6XHJcblx0XHRcdFx0YXBpX3VybCA9IGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG5cdFx0XHRcdGZldGNoX29wdGlvbnMgPSB7bWV0aG9kOiAnR0VUJ307XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJ3Jlc3RhdXJhbnRCeUlkJzpcclxuXHRcdFx0XHRhcGlfdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50cy8ke2FwaS5vYmplY3RfaWR9YDtcclxuXHRcdFx0XHRmZXRjaF9vcHRpb25zID0ge21ldGhvZDogJ0dFVCd9O1xyXG5cdFx0XHRjYXNlICdyZXZpZXdzJzpcclxuXHRcdFx0XHRhcGlfdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzYDtcclxuXHRcdFx0XHRmZXRjaF9vcHRpb25zID0ge21ldGhvZDogJ0dFVCd9O1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlICdyZXZpZXdCeUlkJzpcclxuXHRcdFx0XHRhcGlfdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7YXBpLm9iamVjdF9pZH1gO1xyXG5cdFx0XHRcdGZldGNoX29wdGlvbnMgPSB7bWV0aG9kOiAnR0VUJ307XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJ2FkZFJldmlldyc6XHJcblx0XHRcdFx0YXBpX3VybCA9IGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3c2A7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0bGV0IHJldmlldyA9IHtcclxuXHRcdFx0XHRcdFwibmFtZVwiOiBhcGkuZGF0YVswXSxcclxuXHRcdFx0XHRcdFwicmF0aW5nXCI6IHBhcnNlSW50KGFwaS5kYXRhWzFdKSxcclxuXHRcdFx0XHRcdFwiY29tbWVudHNcIjogYXBpLmRhdGFbMl0sXHJcblx0XHRcdFx0XHRcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQoYXBpLmRhdGFbM10pXHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdFx0ZmV0Y2hfb3B0aW9ucyA9IHtcclxuXHRcdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxyXG5cdFx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KSxcclxuXHRcdFx0XHRcdGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcclxuXHRcdFx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG5cdFx0XHRcdFx0fSkgXHJcblx0XHRcdFx0fTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnZmF2b3JpemUnOlxyXG5cdFx0XHRcdGFwaV91cmwgPSBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzLyR7YXBpLm9iamVjdF9pZH0vP2lzX2Zhdm9yaXRlPSR7YXBpLmRhdGF9YDtcclxuXHRcdFx0XHRmZXRjaF9vcHRpb25zID0ge21ldGhvZDogJ1BVVCd9O1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRkZWZhdWx0OlxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZldGNoKGFwaV91cmwsZmV0Y2hfb3B0aW9ucykudGhlbiggKHJlc3BvbnNlKSA9PiB7XHJcblx0XHRcdGNvbnNvbGUubG9nKGBTZXJ2ZXI6ICR7YXBpLm5hbWV9IGFwaSBjYWxsZWRgKTtcclxuXHRcdFx0XHJcblx0XHRcdGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpO1xyXG5cdFx0XHRpZihjb250ZW50VHlwZSAmJiBjb250ZW50VHlwZS5pbmRleE9mKCdhcHBsaWNhdGlvbi9qc29uJykgIT09IC0xICkge1xyXG5cdFx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcblx0XHRcdH0gZWxzZSB7IFxyXG5cdFx0XHRcdHJldHVybiAnQVBJIGNhbGwgc3VjY2Vzc2Z1bGwnO1xyXG5cdFx0XHR9XHJcblx0XHR9KS50aGVuKCAoZGF0YSkgPT4ge1xyXG5cdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcclxuXHRcdH0pLmNhdGNoKCBlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xyXG5cclxuXHR9O1xyXG5cclxufVxyXG5cclxuLy8gU3RhdGUgTWFuYWdlbWVudFxyXG5jbGFzcyBMb2NhbFN0YXRlIHtcclxuXHJcblx0Ly8gPT09IFVUSUxJVFkgRlVOQ1RJT05TID09PVxyXG5cdC8vIENyZWF0ZXMgb3IgcmV0dXJucyBJbmRleGVkREIgc3RvcmVzXHJcblx0c3RhdGljIHNldHVwSURCU3RvcmVzKHN0b3JlKSB7XHJcblx0XHRzd2l0Y2goc3RvcmUpIHtcclxuXHRcdFx0Y2FzZSAncmVzdGF1cmFudHMnOlxyXG5cdFx0XHRcdGxldCByZXN0YXVyYW50RGJQcm9taXNlID0gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzJywgMSwgKHVwZ3JhZGVEQikgPT4ge1xyXG5cdFx0XHRcdFx0bGV0IHJlc3RhdXJhbnRTdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7a2V5UGF0aDogJ2lkJ30pOyAvLyBWYWx1ZTogS2V5XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3RhdXJhbnREYlByb21pc2U7XHJcblx0XHRcdGNhc2UgJ3Jldmlld3MnOlxyXG5cdFx0XHRcdGxldCByZXZpZXdEYlByb21pc2UgPSBpZGIub3BlbigncmV2aWV3cycsIDEsICh1cGdyYWRlREIpID0+IHtcclxuXHRcdFx0XHRcdGxldCByZXZpZXdTdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cycsIHtrZXlQYXRoOiAnaWQnfSk7XHJcblx0XHRcdFx0XHRyZXZpZXdTdG9yZS5jcmVhdGVJbmRleCgnYnktcmVzdGF1cmFudElkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRyZXR1cm4gcmV2aWV3RGJQcm9taXNlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gQ2hlY2sgZm9yIERhdGEgaW4gSURCLCBzZXJ2ZSwgZmV0Y2ggYW5kIHVwZGF0ZVxyXG5cdHN0YXRpYyBjaGVja2ZvcklEQkRhdGEoYXBpLCBjYWxsYmFjaykge1xyXG5cclxuXHRcdGNvbnN0IGRiUHJvbWlzZSA9IExvY2FsU3RhdGUuc2V0dXBJREJTdG9yZXMoYXBpLm9iamVjdF90eXBlKVxyXG5cdFx0XHJcblx0XHRkYlByb21pc2UudGhlbiggZGIgPT4ge1xyXG5cdFx0XHRsZXQgdHggPSBkYi50cmFuc2FjdGlvbihhcGkub2JqZWN0X3R5cGUpO1xyXG5cdFx0XHRsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShhcGkub2JqZWN0X3R5cGUpO1xyXG5cdFx0XHRyZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XHJcblx0XHR9KS50aGVuKCBkYXRhID0+IHtcclxuXHJcblx0XHRcdC8vIERhdGEgaW4gSURCOiBTZW5kIHRvIGZyb250LWVuZCwgZmV0Y2ggZnJvbSBBUEksIGNvbXBhcmUgJiB1cGRhdGVcclxuXHRcdFx0aWYoZGF0YS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coYElEQjogJHthcGkubmFtZX0gcmV0cmlldmVkOmAsIGRhdGEpO1xyXG5cclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcclxuXHJcblx0XHRcdFx0bGV0IGRhdGFSZWZyZXNoZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZGF0YVJlZnJlc2hlZCcpO1xyXG5cclxuXHRcdFx0XHRpZighZGF0YVJlZnJlc2hlZCB8fCAoZGF0YVJlZnJlc2hlZCAtIG5ldyBEYXRlKCkpIC8gMTAwMCA+IDMwMCAgKcKge1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGF0YVJlZnJlc2hlZCcsIG5ldyBEYXRlKCkpO1xyXG5cclxuXHRcdFx0XHRcdEFwaVNlcnZpY2UuZmV0Y2hBcGlEYXRhKGFwaSwgKGVycm9yLCBkYXRhKSA9PiB7XHJcblx0XHRcdFx0XHRcdGxldCB3b3JrZXIgPSBuZXcgV29ya2VyKCdqcy93b3JrZXIuanMnKTtcclxuXHJcblx0XHRcdFx0XHRcdGxldCB3b3JrZXJEYXRhID0ge1xyXG5cdFx0XHRcdFx0XHRcdGFwaTogYXBpLm5hbWUsXHJcblx0XHRcdFx0XHRcdFx0b2JqZWN0czogZGF0YVxyXG5cdFx0XHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRcdFx0d29ya2VyLnBvc3RNZXNzYWdlKHdvcmtlckRhdGEpO1xyXG5cdFx0XHRcdFx0XHR3b3JrZXIub25tZXNzYWdlID0gKGUpID0+IGNvbnNvbGUubG9nKGUuZGF0YSk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHQvLyBEYXRhIG5vdCBpbiBJREI6IEZldGNoIGZyb20gQVBJLCBzZW5kIHRvIGZyb250LWVuZCwgc3RvcmUgaW4gSURCXHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coYElEQjogTm8gJHthcGkubmFtZX0gZm91bmRgKTtcclxuXHJcblx0XHRcdFx0QXBpU2VydmljZS5mZXRjaEFwaURhdGEoYXBpLCAoZXJyb3IsIGRhdGEpID0+IHtcclxuXHJcblx0XHRcdFx0XHRMb2NhbFN0YXRlLnNldHVwSURCU3RvcmVzKGFwaS5vYmplY3RfdHlwZSkudGhlbiggZGIgPT4ge1xyXG5cdFx0XHRcdFx0XHRsZXQgdHggPSBkYi50cmFuc2FjdGlvbihhcGkub2JqZWN0X3R5cGUsICdyZWFkd3JpdGUnKTtcclxuXHRcdFx0XHRcdFx0bGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYXBpLm9iamVjdF90eXBlKTtcclxuXHJcblx0XHRcdFx0XHRcdGRhdGEuZm9yRWFjaCggb2JqZWN0ID0+IHtcclxuXHRcdFx0XHRcdFx0XHRzdG9yZS5wdXQob2JqZWN0KTtcclxuXHRcdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZygnSURCOiBEYXRhIHN0b3JlZDogJywgZGF0YSlcclxuXHJcblx0XHRcdFx0XHRcdHJldHVybiBkYXRhO1xyXG5cdFx0XHRcdFx0fSkudGhlbiggKGRhdGEpID0+IGNhbGxiYWNrKG51bGwsIGRhdGEpKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdH1cclxuXHJcblx0Ly8gVXBkYXRlIElEQiB3aXRoIGZyb250LWVuZCB1c2VyIGlucHV0IGRhdGFcclxuXHRzdGF0aWMgdXBkYXRlSURCRGF0YShhcGksIGNhbGxiYWNrKSB7XHJcblxyXG5cdFx0bGV0IGRiUHJvbWlzZSA9IExvY2FsU3RhdGUuc2V0dXBJREJTdG9yZXMoYXBpLm9iamVjdF90eXBlKTtcclxuXHJcblx0XHRkYlByb21pc2UudGhlbiggZGIgPT4ge1xyXG5cdFx0XHRsZXQgdHggPSBkYi50cmFuc2FjdGlvbihhcGkub2JqZWN0X3R5cGUpO1xyXG5cdFx0XHRsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShhcGkub2JqZWN0X3R5cGUpO1xyXG5cdFx0XHRyZXR1cm4gc3RvcmUuZ2V0KGFwaS5vYmplY3RfaWQpO1xyXG5cdFx0fSkudGhlbiggb2JqZWN0ID0+IHtcclxuXHRcdFx0b2JqZWN0LmlzX2Zhdm9yaXRlID0gYXBpLmRhdGE7XHJcblx0XHRcdCBcclxuXHRcdFx0ZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcclxuXHRcdFx0XHRsZXQgdHggPSBkYi50cmFuc2FjdGlvbihhcGkub2JqZWN0X3R5cGUsICdyZWFkd3JpdGUnKTtcclxuXHRcdFx0XHRsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShhcGkub2JqZWN0X3R5cGUpO1xyXG5cdFx0XHRcdHN0b3JlLnB1dChvYmplY3QpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fSkudGhlbiggKCkgPT4gY2FsbGJhY2sobnVsbCwgYElEQjogJHtvYmplY3QubmFtZX0gZmF2b3JpemVkIWApKTtcclxuXHJcblx0XHR9KTtcclxuXHJcblx0fVxyXG5cclxuXHRzdGF0aWMgc2VuZERhdGFXaGVuT25saW5lKGFwaSkge1xyXG5cclxuXHRcdGNvbnNvbGUubG9nKGFwaSk7XHJcblxyXG5cdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2RhdGEnLCBKU09OLnN0cmluZ2lmeShhcGkuZGF0YSkpO1xyXG5cdFx0Y29uc29sZS5sb2coYExvY2FsIFN0b3JhZ2U6ICR7YXBpLm9iamVjdF90eXBlfSBzdG9yZWRgKTtcclxuXHRcdFxyXG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIChldmVudCkgPT4ge1xyXG5cclxuXHRcdFx0bGV0IGRhdGEgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhJykpO1xyXG5cclxuXHRcdFx0aWYoZGF0YSAhPT0gbnVsbCkge1xyXG5cdFx0XHJcblx0XHRcdFx0Y29uc29sZS5sb2coZGF0YSk7XHJcblx0XHRcclxuXHRcdFx0XHRBcGlTZXJ2aWNlLmZldGNoQXBpRGF0YShhcGksIChlcnJvciwgZGF0YSkgPT4ge1xyXG5cdFx0XHRcdFx0ZXJyb3IgPyBjb25zb2xlLmxvZyhlcnJvcikgOiBjb25zb2xlLmxvZyhkYXRhKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRjb25zb2xlLmxvZygnTG9jYWxTdGF0ZTogZGF0YSBzZW50IHRvIGFwaScpO1xyXG5cdFx0XHJcblx0XHRcdFx0bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2RhdGEnKTtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhgTG9jYWwgU3RvcmFnZTogJHthcGkub2JqZWN0X3R5cGV9IHJlbW92ZWRgKVxyXG5cdFx0XHR9XHJcblx0XHRcdGNvbnNvbGUubG9nKCdCcm93c2VyOiBPbmxpbmUgYWdhaW4hJyk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8vID09PSBHZXR0ZXIgRlVOQ1RJT05TID09PVxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuXHRcdGxldCBhcGkgPSB7XHJcblx0XHRcdG5hbWU6ICdyZXN0YXVyYW50QnlJZCcsXHJcblx0XHRcdG9iamVjdF90eXBlOiAncmVzdGF1cmFudHMnLFxyXG5cdFx0XHRvYmplY3RfaWQ6IGlkXHJcblx0XHR9O1xyXG5cclxuXHRcdExvY2FsU3RhdGUuY2hlY2tmb3JJREJEYXRhKGFwaSwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGVycm9yKSBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdFxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZCggciA9PiByLmlkID09IGlkKTtcclxuXHRcdFx0XHQhcmVzdGF1cmFudCA/IGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk6IGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcblxyXG5cdFx0bGV0IGFwaSA9IHtcclxuXHRcdFx0bmFtZTogJ3Jlc3RhdXJhbnRzJyxcclxuXHRcdFx0b2JqZWN0X3R5cGU6ICdyZXN0YXVyYW50cydcclxuXHRcdH07XHJcblxyXG5cdFx0TG9jYWxTdGF0ZS5jaGVja2ZvcklEQkRhdGEoYXBpLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblxyXG5cdFx0XHRpZihlcnJvcikgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG5cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBjdWlzaW5lcyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG5cdFx0bGV0IGFwaSA9IHtcclxuXHRcdFx0bmFtZTogJ3Jlc3RhdXJhbnRzJyxcclxuXHRcdFx0b2JqZWN0X3R5cGU6ICdyZXN0YXVyYW50cydcclxuXHRcdH07XHJcblxyXG5cdFx0TG9jYWxTdGF0ZS5jaGVja2ZvcklEQkRhdGEoYXBpLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdFxyXG5cdFx0XHRpZihlcnJvcikgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG5cdFx0XHRcclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgbmVpZ2hib3Job29kcyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spwqB7XHJcblx0XHRsZXQgYXBpID0ge1xyXG5cdFx0XHRuYW1lOiAncmVzdGF1cmFudHMnLFxyXG5cdFx0XHRvYmplY3RfdHlwZTogJ3Jlc3RhdXJhbnRzJ1xyXG5cdFx0fTtcclxuXHJcblx0XHRMb2NhbFN0YXRlLmNoZWNrZm9ySURCRGF0YShhcGksIChlcnJvciwgcmVzdGF1cmFudHMpID0+e1xyXG5cdFx0XHRpZihlcnJvcikgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG5cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0bGV0IGZpbHRlcmVkUmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxuXHJcblx0XHRcdFx0aWYoY3Vpc2luZSAhPT0gJ2FsbCcpIHtcclxuXHRcdFx0XHRcdGZpbHRlcmVkUmVzdGF1cmFudHMgPSBmaWx0ZXJlZFJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09PSBjdWlzaW5lKTsgXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZihuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcclxuXHRcdFx0XHRcdGZpbHRlcmVkUmVzdGF1cmFudHMgPSBmaWx0ZXJlZFJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09PSBuZWlnaGJvcmhvb2QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBmaWx0ZXJlZFJlc3RhdXJhbnRzKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuXHJcblx0XHRsZXQgYXBpID0ge1xyXG5cdFx0XHRuYW1lOiAncmVzdGF1cmFudHMnLFxyXG5cdFx0XHRvYmplY3RfdHlwZTogJ3Jlc3RhdXJhbnRzJ1xyXG5cdFx0fTtcclxuXHJcblx0XHRMb2NhbFN0YXRlLmNoZWNrZm9ySURCRGF0YShhcGksIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuXHRcdFx0aWYoZXJyb3IpIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHJcblx0XHRcdGVsc2Uge1xyXG5cdFxyXG5cdFx0XHQvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuXHRcdFx0Y29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcclxuXHRcdFx0XHQodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXHJcblx0XHRcdCk7XHJcblxyXG5cdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuXHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxyXG5cdFx0XHRcdCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaVxyXG5cdFx0XHQpO1xyXG5cclxuXHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRDdWlzaW5lcyhjYWxsYmFjaykge1xyXG5cclxuXHRcdGxldCBhcGkgPSB7XHJcblx0XHRcdG5hbWU6ICdyZXN0YXVyYW50cycsXHJcblx0XHRcdG9iamVjdF90eXBlOiAncmVzdGF1cmFudHMnXHJcblx0XHR9O1xyXG5cclxuXHRcdExvY2FsU3RhdGUuY2hlY2tmb3JJREJEYXRhKGFwaSwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRcdC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuXHRcdFx0XHRjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcblx0XHRcdFx0Y29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXHJcblx0XHRcdFx0XHQodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXHJcblx0XHRcdFx0KTtcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldFJldmlld3NCeVJlc3RhdXJhbnQocmVzdGF1cmFudElkLCBjYWxsYmFjaykge1xyXG5cdFx0XHJcblx0XHRsZXQgYXBpID0ge1xyXG5cdFx0XHRuYW1lOiAncmV2aWV3QnlJZCcsXHJcblx0XHRcdG9iamVjdF90eXBlOiAncmV2aWV3cycsXHJcblx0XHRcdG9iamVjdF9pZDogcmVzdGF1cmFudElkXHJcblx0XHR9O1xyXG5cclxuXHRcdExvY2FsU3RhdGUuY2hlY2tmb3JJREJEYXRhKGFwaSwgKGVycm9yLCByZXZpZXdzKSA9PiB7XHJcblx0XHRcdGlmKGVycm9yKSBjYWxsYmFjayhudWxsLCBlcnJvcik7XHJcblx0XHRcdFxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRjb25zdCBmaWx0ZXJlZFJldmlld3MgPSByZXZpZXdzLmZpbHRlciggciA9PiByLnJlc3RhdXJhbnRfaWQgPT09IHJlc3RhdXJhbnRJZCk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZmlsdGVyZWRSZXZpZXdzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0VXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcblx0XHRyZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldEltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcblx0XHRyZXR1cm4gYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2A7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0TWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuXHRcdGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG5cdFx0XHRwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcblx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcblx0XHRcdHVybDogTG9jYWxTdGF0ZS5nZXRVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG5cdFx0XHRtYXA6IG1hcCxcclxuXHRcdFx0YW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG5cdFx0fSk7XHJcblx0XHRyZXR1cm4gbWFya2VyO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIHRvZ2dsZUZhdm9yaXRlKG1vZGUsIHJlc3RhdXJhbnRJZCkge1xyXG5cclxuXHRcdHJlc3RhdXJhbnRJZCA9IHBhcnNlSW50KHJlc3RhdXJhbnRJZCk7XHJcblxyXG5cdFx0bGV0IGFwaSA9IHtcclxuXHRcdFx0bmFtZTogJ2Zhdm9yaXplJyxcclxuXHRcdFx0b2JqZWN0X3R5cGU6ICdyZXN0YXVyYW50cycsXHJcblx0XHRcdG9iamVjdF9pZDogcmVzdGF1cmFudElkLFxyXG5cdFx0XHRkYXRhOiBtb2RlXHJcblx0XHR9O1xyXG5cclxuXHRcdExvY2FsU3RhdGUudXBkYXRlSURCRGF0YShhcGksIChlcnJvciwgZGF0YSkgPT4ge1xyXG5cdFx0XHRpZihlcnJvcikgY29uc29sZS5sb2coZXJyb3IpO1xyXG5cdFx0fSk7XHJcblx0XHRcclxuXHRcdEFwaVNlcnZpY2UuZmV0Y2hBcGlEYXRhKGFwaSwgKGVycm9yLCBkYXRhKSA9PiB7XHJcblx0XHRcdGVycm9yID8gY29uc29sZS5sb2coZXJyb3IpOiBjb25zb2xlLmxvZyhgU2VydmVyOiAke2RhdGEubmFtZX0gdXBkYXRlZGApO1xyXG5cdFx0fSk7XHJcblxyXG5cdH1cclxuXHJcblx0c3RhdGljIGFkZFJldmlldyhyZXZpZXcpIHtcclxuXHJcblx0XHRsZXQgYXBpID0ge1xyXG5cdFx0XHRuYW1lOiAnYWRkUmV2aWV3JyxcclxuXHRcdFx0ZGF0YTogcmV2aWV3LFxyXG5cdFx0XHRvYmplY3RfdHlwZTogJ3JldmlldydcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gU2VuZCB0byBMb2NhbFN0YXRlIGZvciB1cGRhdGVcclxuXHRcdEFwaVNlcnZpY2UuZmV0Y2hBcGlEYXRhKGFwaSwgKGVycm9yLCBkYXRhKSA9PiB7XHJcblx0XHRcdGVycm9yID8gY29uc29sZS5sb2coZXJyb3IpIDogY29uc29sZS5sb2coYFNlcnZlcjogUmV2aWV3IHVwbG9hZGVkYCk7XHJcblx0XHR9KTtcclxuXHJcblx0fVxyXG5cclxufVxyXG4iXX0=
