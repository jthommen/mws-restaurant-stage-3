let restaurants,neighborhoods,cuisines,map,observer,mapLoaded=!1,markers=[];function onIntersection(e){e.forEach(e=>{e.intersectionRatio>0&&(observer.unobserve(e.target),e.target.getAttribute("data-src")&&e.target.setAttribute("src",e.target.getAttribute("data-src")))})}document.addEventListener("DOMContentLoaded",e=>{document.getElementById("map").addEventListener("click",initMap),document.getElementById("cuisines-select").addEventListener("change",e=>{mapLoaded||initMap()}),document.getElementById("neighborhoods-select").addEventListener("change",e=>{mapLoaded||initMap()}),LocalState.checkforIDBData({name:"restaurants",object_type:"restaurants"},(e,t)=>{console.log("Initial Load finished!"),fetchNeighborhoods(),fetchCuisines(),registerServiceWorker(),updateRestaurants()})}),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("./service-worker.js").then(()=>{console.log("Service Worker: Registered!")}).catch(e=>{console.log(`Service Worker: Registration failed: ${e}`)})}),fetchNeighborhoods=(()=>{LocalState.getNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{LocalState.getCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants(),mapLoaded=!0}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,a=t.selectedIndex,o=e[r].value,s=t[a].value;LocalState.getRestaurantByCuisineAndNeighborhood(o,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),lazyLoadingObserver=(()=>{const e=document.querySelectorAll(".restaurant-img");observer=new IntersectionObserver(onIntersection,{rootMargin:"50px 0px",threshold:.01}),e.forEach(e=>observer.observe(e))}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",mapLoaded&&self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),mapLoaded&&addMarkersToMap(),lazyLoadingObserver()}),placeholder_img="data:image/png;base64,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",createRestaurantHTML=(e=>{const t=document.createElement("li"),r=document.createElement("img");r.className="restaurant-img",r.setAttribute("src",placeholder_img);const a=LocalState.getImageUrlForRestaurant(e);/undefined/.test(a)?(r.setAttribute("data-src","/img/icons/icon-placeholder.png"),console.log("Image undefined!")):r.setAttribute("data-src",a),r.setAttribute("alt",`Restaurant ${e.name}`),t.append(r);const o=document.createElement("h3");o.innerHTML=e.name,t.append(o);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const n=document.createElement("p");n.innerHTML=e.address,t.append(n);const i=document.createElement("a");i.innerHTML="View Details",i.href=LocalState.getUrlForRestaurant(e),t.append(i);const c=document.createElement("img");return c.setAttribute("alt","Heart"),c.classList.add("favorize"),c.id=e.id,!0===e.is_favorite||"true"===e.is_favorite?(c.setAttribute("src","/img/icons/favorized.svg"),c.classList.add("favorized")):c.setAttribute("src","/img/icons/favorite.svg"),c.onclick=function(){this.classList.contains("favorized")?(this.src="/img/icons/favorite.svg",this.classList.remove("favorized"),LocalState.toggleFavorite(!1,this.id)):(this.src="/img/icons/favorized.svg",this.classList.add("favorized"),LocalState.toggleFavorite(!0,this.id))},t.append(c),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=LocalState.getMapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});